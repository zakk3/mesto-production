(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const c of r)if(c.type==="childList")for(const i of c.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function o(r){const c={};return r.integrity&&(c.integrity=r.integrity),r.referrerPolicy&&(c.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?c.credentials="include":r.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function n(r){if(r.ep)return;r.ep=!0;const c=o(r);fetch(r.href,c)}})();const s={baseUrl:"https://mesto.nomoreparties.co/v1/apf-cohort-202",headers:{authorization:"1ebee4ac-1b4c-4ad4-87dd-7a11af33cea6","Content-Type":"application/json"}},a=e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`),Q=()=>fetch(`${s.baseUrl}/users/me`,{headers:s.headers}).then(a),T=()=>fetch(`${s.baseUrl}/cards`,{headers:s.headers}).then(a),X=({name:e,about:t})=>fetch(`${s.baseUrl}/users/me`,{method:"PATCH",headers:s.headers,body:JSON.stringify({name:e,about:t})}).then(a),Y=e=>fetch(`${s.baseUrl}/users/me/avatar`,{method:"PATCH",headers:s.headers,body:JSON.stringify({avatar:e})}).then(a),D=({name:e,link:t})=>fetch(`${s.baseUrl}/cards`,{method:"POST",headers:s.headers,body:JSON.stringify({name:e,link:t})}).then(a),ee=e=>fetch(`${s.baseUrl}/cards/${e}`,{method:"DELETE",headers:s.headers}).then(a),te=(e,t)=>fetch(`${s.baseUrl}/cards/likes/${e}`,{method:t?"DELETE":"PUT",headers:s.headers}).then(a),oe=document.querySelector("#card-template").content,N=(e,t,o)=>{const n=oe.querySelector(".places__item").cloneNode(!0),r=n.querySelector(".card__image"),c=n.querySelector(".card__title"),i=n.querySelector(".card__like-button"),w=n.querySelector(".card__like-count"),x=n.querySelector(".card__control-button_type_delete");n.querySelector(".card__control-button_type_info").addEventListener("click",()=>{o.handleInfoClick(e._id)}),c.textContent=e.name,r.src=e.link,r.alt=e.name;const K=e.likes.some(S=>S._id===t);return i.classList.toggle("card__like-button_is-active",K),w.textContent=e.likes.length,e.owner._id!==t?x.remove():x.addEventListener("click",()=>{ee(e._id).then(()=>{n.remove()}).catch(console.log)}),i.addEventListener("click",()=>{const S=i.classList.contains("card__like-button_is-active");te(e._id,S).then(v=>{const Z=v.likes.some(G=>G._id===t);i.classList.toggle("card__like-button_is-active",Z),w.textContent=v.likes.length,e.likes=v.likes}).catch(console.log)}),r.addEventListener("click",()=>{o.onPreviewPicture({name:e.name,link:e.link})}),n},O=e=>{if(e.key==="Escape"){const t=document.querySelector(".popup_is-opened");u(t)}},f=e=>{e.classList.add("popup_is-opened"),document.addEventListener("keyup",O)},u=e=>{e.classList.remove("popup_is-opened"),document.removeEventListener("keyup",O)},re=e=>{e.querySelector(".popup__close").addEventListener("click",()=>{u(e)}),e.addEventListener("mousedown",o=>{o.target.classList.contains("popup")&&u(e)})},ne=e=>{if(e.validity.valueMissing)return"Это обязательное поле";if(e.validity.typeMismatch){if(e.type==="url")return"Пожалуйста, введите корректный URL";if(e.type==="email")return"Пожалуйста, введите корректный адрес электронной почты"}return e.validity.tooShort?`Минимальная длина: ${e.minLength} символов`:e.validity.tooLong?`Максимальная длина: ${e.maxLength} символов`:"Некорректное значение"},ce=(e,t,o,n)=>{const r=e.querySelector(`#${t.id}-error`);t.classList.add(n.inputErrorClass),r.textContent=o,r.classList.add(n.errorClass)},W=(e,t,o)=>{const n=e.querySelector(`#${t.id}-error`);t.classList.remove(o.inputErrorClass),n.classList.remove(o.errorClass),n.textContent=""},se=(e,t,o)=>{if(t.validity.valid)W(e,t,o);else{let n=ne(t);if(t.classList.contains("popup__input_type_name")||t.classList.contains("popup__input_type_card-name")){const r=/^[а-яА-ЯёЁa-zA-Z\s\-]*$/;t.value&&!r.test(t.value)&&(n=t.dataset.errorMessage)}ce(e,t,n,o)}},ie=e=>e.some(t=>!t.validity.valid),R=(e,t)=>{e.classList.add(t.inactiveButtonClass),e.disabled=!0},le=(e,t)=>{e.classList.remove(t.inactiveButtonClass),e.disabled=!1},M=(e,t,o)=>{ie(e)?R(t,o):le(t,o)},ae=(e,t)=>{const o=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);M(o,n,t),o.forEach(r=>{r.addEventListener("input",()=>{se(e,r,t),M(o,n,t)})})},q=(e,t)=>{const o=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);o.forEach(r=>{W(e,r,t)}),R(n,t)},ue=e=>{Array.from(document.querySelectorAll(e.formSelector)).forEach(o=>{ae(o,e)})},p=(e,t,o)=>{t?e.textContent=o==="Создать"?"Создание...":"Сохранение...":e.textContent=o},pe=e=>e.toLocaleDateString("ru-RU",{year:"numeric",month:"long",day:"numeric"}),y=(e,t)=>{const n=document.querySelector("#popup-info-definition-template").content.cloneNode(!0);return n.querySelector(".popup__info-title").textContent=e,n.querySelector(".popup__info-value").textContent=t,n},h={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},L=document.querySelector(".popup_type_info"),_=L.querySelector(".popup__info-list");ue(h);const H=document.querySelector(".places__list"),g=document.querySelector(".popup_type_edit"),m=g.querySelector(".popup__form"),j=m.querySelector(".popup__input_type_name"),J=m.querySelector(".popup__input_type_description"),C=document.querySelector(".popup_type_new-card"),l=C.querySelector(".popup__form"),de=l.querySelector(".popup__input_type_card-name"),_e=l.querySelector(".popup__input_type_url"),k=document.querySelector(".popup_type_image"),$=k.querySelector(".popup__image"),fe=k.querySelector(".popup__caption"),me=document.querySelector(".profile__edit-button"),ye=document.querySelector(".profile__add-button"),E=document.querySelector(".profile__title"),I=document.querySelector(".profile__description"),P=document.querySelector(".profile__image"),B=document.querySelector(".popup_type_edit-avatar"),d=B.querySelector(".popup__form"),he=d.querySelector(".popup__input"),V=({name:e,link:t})=>{$.src=t,$.alt=e,fe.textContent=e,f(k)},Se=e=>{e.preventDefault(),p(A,!0,"Сохранить"),X({name:j.value,about:J.value}).then(t=>{E.textContent=t.name,I.textContent=t.about,u(g)}).catch(console.log).finally(()=>{p(A,!1,"Сохранить")})},ve=e=>{e.preventDefault(),p(F,!0,"Сохранить"),Y(he.value).then(t=>{P.style.backgroundImage=`url(${t.avatar})`,u(B),d.reset()}).catch(console.log).finally(()=>{p(F,!1,"Сохранить")})},z=e=>{T().then(t=>{const o=t.find(r=>r._id===e);_.innerHTML="",_.append(y("Описание:",o.name)),_.append(y("Дата создания:",pe(new Date(o.createdAt)))),_.append(y("Владелец:",o.owner.name)),_.append(y("Количество лайков:",o.likes.length));const n=L.querySelector(".popup__list");n.innerHTML="",o.likes.forEach(r=>{const i=document.querySelector("#popup-info-user-preview-template").content.cloneNode(!0);i.querySelector(".popup__list-item").textContent=r.name,n.append(i)}),f(L)}).catch(console.error)},Le=e=>{e.preventDefault(),p(U,!0,"Создать"),D({name:de.value,link:_e.value}).then(t=>{H.prepend(N(t,b,{onPreviewPicture:V,handleInfoClick:z})),u(C),l.reset()}).catch(console.log).finally(()=>{p(U,!1,"Создать")})};m.addEventListener("submit",Se);l.addEventListener("submit",Le);d.addEventListener("submit",ve);const A=m.querySelector(".popup__button"),U=l.querySelector(".popup__button"),F=d.querySelector(".popup__button");me.addEventListener("click",()=>{j.value=E.textContent,J.value=I.textContent,q(m,h),f(g)});P.addEventListener("click",()=>{d.reset(),q(d,h),f(B)});ye.addEventListener("click",()=>{l.reset(),q(l,h),f(C)});const be=document.querySelectorAll(".popup");be.forEach(e=>{re(e)});let b=null;Promise.all([Q(),T()]).then(([e,t])=>{b=e._id,E.textContent=e.name,I.textContent=e.about,P.style.backgroundImage=`url(${e.avatar})`,t.forEach(o=>{H.append(N(o,b,{onPreviewPicture:V,handleInfoClick:z}))})}).catch(console.log);
